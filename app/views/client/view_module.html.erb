<style>
  .trail-header{
      background: #f8f8ff;
  }

    .enc-row td{
        border: 1px solid #f8f8ff !important;
        padding: 7px;
        padding-left: 20px;
        width: 50%;
    }
  .enc-row .header{
      font-weight: bold;
      text-align: right;
      padding-right: 20px;
  }
</style>
<div>
  <ol class="breadcrumb " style="margin: 3px; padding: 5px;">
    <li><a href="/">Home</a></li>
    <li><a href="/client/index">Clients</a></li>
    <li><a class='active' href="/client/view?client_id=<%=@client.id%>">View Client</a></li>
  </ol>
</div>
<div class="panel panel-primary">
    <div class="panel-heading ">
      <span class="glyphicon glyphicon-eye-open"></span>
      <b><%=params[:module]%></b>
      <div class="panel-btn" style="padding: 8px;">
            &nbsp;
      </div>
    </div>
    <div class="panel-body">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-4" style="border-right: 1px solid lightblue;">
            <div class="display-details">
              <h3><strong>Name</strong><%= @client.first_name%> <%= @client.last_name%> (<%= {'1' => 'M', '0' => 'F'}[@client.gender.to_s]%>)</h3>
              <p><strong>Identifier(s)</strong><%=@client.identifier%></p>
              <p><strong>Client Type</strong><%=@client_type%></p>
              <p><strong>Birthdate</strong><%=@client.birthdate.strftime('%d-%b-%Y')%></p>
              <p><strong>Physical Address</strong><%=@client.address%></p>
              <p><strong>Phone Number</strong><%=@client.phone_number%></p>
              <p><strong>E-mail Address</strong><%=@client.email%></p>
              <p><strong>Occupation</strong><%=@client.occupation%></p>
            </div>
          </div>

          <div class="col-md-8" style="padding: 0px;">
            <div class="col-md-12">
              <% (@common_encounters || []).each do |name, count, route|%>
                <button type="button" onclick="window.location = '/<%= route%>' "
                     class="btn btn-sm btn-default encounter-btn pull-left" style="width: 31%;margin: 5px; margin-bottom: 10px;"
                ><%=name%>
                    <span class="badge" style="background: #2e6da4;"><%= count%></span>
                </button>
              <% end %>
              </div>

            </div>
        </div>


        <div class="card">

          <nav class="card-header navbar-light" style="padding-top:1px;margin-top: 4px;box-shadow: 4px 4px 3px lightgrey;
                  background: #f8f8ff; border-bottom: 1px solid darkred !important;text-align: center; ">
              <h4>Patient <%= params[:module]%> History </h4>
          </nav>
          <table class="table table-condensed table-bordered" style="color: darkslategray">
            <thead>
            <tr class="table-row trail-row">
              <th class="table-cell trail-header" style="min-width: 13% ;">Date</th>
              <th class="table-cell col-md-2 trail-header">Encounter</th>
              <th class="table-cell col-md-4 trail-header">Details</th>
              <th class="table-cell col-md-2 trail-header">Performed By</th>
              <th class="table-cell trail-header">Actions</th>
            </tr>
            </thead>

            <tbody>
            <% (@data || []).each do |data| %>
                <tr class="table-row trail-row">
                  <td class="table-cell trail-data"><%= data['date'].html_safe%></td>
                  <td class="table-cell trail-data"><%= data['title']%></td>
                  <td class="table-cell trail-data"><%= data['content'].html_safe%></td>
                  <td class="table-cell trail-data"><%= data['user']%></td>
                  <td class="table-cell trail-data" style="min-width: 25%;">
                    <a class="btn btn-danger btn-sm" disabled="disabled"><span class="glyphicon glyphicon-remove"></span>Void</a>
                    <a class="btn btn-warning btn-sm" disabled="disabled" ><span class="glyphicon glyphicon-edit"></span>Edit</a>
                    <a onclick="loadEnc('<%= data['title']%>', '<%= data['data'].to_json%>')" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-eye-open"></span>View</a>

                  </td>
                </tr>
            <% end %>
            </tbody>
          </table>

        </div>

      </div>
    </div>
</div>

<div class="col-lg-12">
  <div class="modal fade" id="enc-popup" tabindex="-1" role="dialog"  aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" style="background: #f8f8ff; text-align: center;font-weight: bold !important;">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title" id="enc-popup-title">&nbsp;</h4>
        </div>
        <div class="modal-body">
            <table id="enc-popup-data" class="table table-condensed table-striped">
            </table>
        </div>
        <div class="modal-footer" style="background: white;">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Print Label</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    $(document).ready(function() {

        table = $('.table').DataTable({});
    })

    function loadEnc(title, json){
        $("#enc-popup-title").html("");
        $("#enc-popup-data").empty();

        var table = document.getElementById("enc-popup-data")
        var data = JSON.parse(json);

        $("#enc-popup-title").html(title);

        for(var i = 0; i < data.length; i ++){
            var tr = document.createElement("tr")
            tr.className = "table-row enc-row";

            var col1 = document.createElement("td")
            col1.className = "table-cell header"
            col1.innerHTML = data[i][0];
            tr.appendChild(col1);

            var col2 = document.createElement("td")
            col2.className = "table-cell data"
            col2.innerHTML = data[i][1];
            tr.appendChild(col2);

            table.appendChild(tr);
        }

        $("#enc-popup").modal("show");
    }
</script>